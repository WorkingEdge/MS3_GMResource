{% extends "base.html" %}

{% block content %}

{% if session.session_user %}
<a class="btn btn-default btn-secondary" href="{{ url_for('add_product') }}">Add New Product</a>
{% endif%}

<table class="table table-default">
    <tr>
        <th>#</th>
        <th>Name</th>
        <th>Contains</th>
        <th>Note</th>
        <th>Price</th>
        <th>Admin</th>
      </tr>

      {% for product in products %}
    <tr>
        <td>{{ loop.index }}</td>
        <td>{{ product.prod_name|title }}</td>
        <td>
          {% for elem in product.contains_common %}
          {{- elem | title -}}
          {{ "," if not loop.last else "" }} 
          <!-- Source: https://stackoverflow.com/questions/11974318/how-to-output-a-comma-delimited-list-in-jinja-python-template-->
          {% endfor %}
        </td>
        <td>{{ product.prod_notes}}</td>
        <td>{% if product.prod_price %} {# Check if a price has been entered for the product, if not print 'Contact us' #}
          {{ product.prod_price }}
          {% else %}
          Contact us  
          {% endif %}</td>
        <td>
          <a class="btn btn-secondary btn-sm" href="{{ url_for('edit_product', product_id = product._id) }}">Edit</a>
          <button type="button" class="btn btn-danger btn-sm" data-toggle="modal" data-target="#confirmDeleteModal-{{ loop.index }}" data-routeinfo="{{ url_for('delete_product', product_id = product._id) }}">Delete</button>
        </td>
      </tr>

<!--Modal to confirm deletion-->
<div class="modal fade" id="confirmDeleteModal-{{ loop.index }}" tabindex="-1" role="dialog" aria-labelledby="confirmDeleteModalTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Delete this product?</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>Deleting the product removes it permanently. Are you sure?</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <form action="{{ url_for('delete_product', product_id = product._id) }}" method="POST">
          <input type="submit" class="btn btn-danger" value="Delete"></form>
      </div>
    </div>
  </div>
</div>

      {% endfor %}
  </table>    
    
{% endblock %}